# 接口规范

## 接口的基本数据格式

数据返回格式都是以JSON的形式，JSON的字段是以 { key: value } 的形式成对出现的。

其中key是用来读取指定数据的标识，并且在同一个层级的数据里，是唯一的存在，而value就是这个key所对应的数据信息。

### 关于key的规范要求

key是用来读取指定数据的标识，**统一用 双引号 套起来**。

- #### 语义化来命名key，并且遵循驼峰命名法

  比如：定义一个用户名字段，使用userName作为key，而username则不建议使用，更不允许使用data1、data2这样毫无意义的命名方式。

- #### 包含“多个结果”的字段，注意名词的复数形式的使用

  1、当value为普通数组时，使用“名词复数”的形式命名key

  2、当value为嵌套了JSON对象的数组时，使用名词 + list结尾的形式来命名key

  比如：

  ```
  {
    "tags": ["生产管理", "劳务管理", "设备管理"],
    "memberList": [
      {
        "uid": 111,
        "name": "华北分公司",
      },
      {
        "uid": 222,
        "name": "湖北分公司",
      }
    ]
  }
  ```

- #### 判断查询类的字段，注意动词的配合

  通常这种情况代表会返回一个布尔值（true/false），常用的有以下几种

    |动词|含义|例子|
    |-|-|-|
    |is|是否符合某个条件|{"isLogined": true}|
    |has|是否包含某数据|{"hasAvatar": false}|
    |can|是否能进行某个动作|{"canDownload": true}|

- #### 使用合理的缩写

  缩写是为了提高开发时的书写效率，但是也要遵循缩写规范，或者仅使用普遍认知的缩写方式，不要自己创造一些只有自己看得懂的缩写方式。

  比如：等级level使用缩写lv，message使用缩写msg，error使用缩写err，user id使用缩写uid，都是允许的，但是user name缩写成un就会一脸懵逼！！！

- #### 避免使用重复的key

  在同一级的关系里，key是唯一，如果有重复，后添加的会覆盖之前添加的。

  不同层级允许使用相同的key命名，但是，容易造成bug, 所以**强烈不推荐**

### 关于value的规范要求

  在JSON规范中，value对应六种不同的数据类型，不同类型的表达形式也有所区分，具体如下：

    |类型|特征|例子|
    |-|-|-|
    |String字符串|value套在双引号中|{"name": "Alan"}|
    |Number数字值|value为整数或者浮点数|{"age": 18, "weight": 67.54}|
    |Boolean布尔值|value为true或false|{"isLogined": true, "isVip": false}| 
    |Array数组|value套装方括号中|{"tags": ["soccer", "football", "baseball", "basketball"]}|
    |Object对象|value套在花括号中|{"userInfo": {"name": "Alan", age: 18}}|
    |Null空类型|value为null|{"wife": null}|

## 接口的业务数据格式

  顾名思义，是指在业务层面上，虽然符合基本规范，但是在使用上可能会存在的一些人为导致的不合理的地方，从而影响到代码的可复用性、灵活程度等等。

### 不同接口的“相同数据”

  每个不同类型的页面，都会对应不同的接口用以支持需要的数据渲染，但在落实业务的时候，“不同的页面”里包含着“相同结构的数据”的情况。

  那么在指定接口格式的时候，相同的这一部分最好就要统一起来。

  统一字段名和数据结构，能有效降低维护过程中的认知成本、对接成本，并且可以封装成公共方法来处理数据调用，减少差错发生。

### 业务状态码与反馈信息

  在http状态码的基础上，接口也都会有自己的一套业务状态码规则，用于反馈接口交互过程中的合法性。

  那什么情况下才需要使用状态码？是不是能考虑到的错误都需要提供错误码给前端判断呢？

  答案是否定的，状态码过多容易造成维护成本的增加，建议只在一些前端完全无法识别的错误场景才提供错误码。

- #### 不需要接口反馈状态码的情况

  前端可以识别的错误场景可以由前端判断解决，无需接口来处理反馈，简单来说，基于常识性的错误，应该都属于前端可掌握的判断范围。

- #### 需要接口反馈状态码的情况

  必须通过服务端确认后才可以得出结论的场景。

- 反馈信息尽量由接口返回

  建议接口在返回code的时候同时返回message，前端在弹出Toast的时候，文案直接使用服务端返回的message来灵活反馈给用户。

  这样不管是修改提示文案，还是新增了新的code，都无需重新修改页面，容错率高。

- 状态码不一定是数字
  
  通过类似`{messageVal: 'data_no_existence', messageStr: '数据不存在'}`, 其中 `messageVal` 就是取代常用的数字状态码，

  这样可以减少查文档的时间，看到文案就知道发生了什么。